{% extends "admin_base.html" %}

{% block title %}Curated Responses{% endblock %}

{% block content %}
<h1>Manage Curated Responses</h1>
<p>Define exact user queries (patterns) and the specific response the chatbot should give, bypassing the AI model.</p>

 <!-- Status Messages -->
{% if request.query_params.get("add_success") %} <p class="status-message success">Curated response added successfully.</p> {% endif %}
{% if request.query_params.get("add_error") %}
    <p class="status-message error">
        Failed to add response:
        {% if request.query_params.get("add_error") == "empty" %} Query or Response cannot be empty.
        {% elif request.query_params.get("add_error") == "exists" %} This query pattern already exists.
        {% else %} Internal server error. Check logs.
        {% endif %}
    </p>
{% endif %}
{% if request.query_params.get("toggle_success") %} <p class="status-message success">Response status toggled.</p> {% endif %}
{% if request.query_params.get("toggle_error") %} <p class="status-message error">Failed to toggle status.</p> {% endif %}
{% if request.query_params.get("delete_success") %} <p class="status-message success">Response deleted successfully.</p> {% endif %}
{% if request.query_params.get("delete_error") %} <p class="status-message error">Failed to delete response.</p> {% endif %}


<h2>Add New Curated Response</h2>
<form action="/admin/curation/add" method="post">
    <div>
        <label for="query_pattern">User Query Pattern (Exact Match):</label>
        <textarea id="query_pattern" name="query_pattern" required></textarea>
    </div>
    <div>
        <label for="response">Bot Response:</label>
         <textarea id="response" name="response" required></textarea>
    </div>
    <button type="submit">Add Response</button>
</form>

<h2>Existing Curated Responses</h2>
 <table>
    <thead>
        <tr>
            <th>Query Pattern</th>
            <th>Response</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        {% for resp in responses %}
        <tr>
            <td>{{ resp.query_pattern | truncate(80) }}</td>
            <td>{{ resp.response | truncate(100) }}</td>
            <td>{{ "Active" if resp.is_active else "Inactive" }}</td>
            <td class="actions">
                <form action="/admin/curation/{{ resp.id }}/toggle" method="post">
                    <button type="submit">{{ "Deactivate" if resp.is_active else "Activate" }}</button>
                </form>
                <form action="/admin/curation/{{ resp.id }}/delete" method="post" onsubmit="return confirm('Are you sure you want to delete this curated response?');">
                    <button type="submit" class="delete">Delete</button>
                </form>
            </td>
        </tr>
        {% else %}
        <tr>
            <td colspan="4">No curated responses defined yet.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}